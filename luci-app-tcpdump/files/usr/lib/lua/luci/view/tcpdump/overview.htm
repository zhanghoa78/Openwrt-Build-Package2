<%+header%>

<!-- 引入外部 CSS -->
<link rel="stylesheet" href="<%=resource%>/view/tcpdump/assets/tcpdump.css" />

<div class="cbi-map">
	<h2 name="content"><%:TCPDump 数据包捕获%></h2>
	<div class="cbi-map-descr">
		<%:简单的 tcpdump 数据包捕获网页界面。%><br>
		<%:捕获文件保存在 /tmp/tcpdump.pcap。%>
	</div>

	<!-- 主设置区域 -->
	<fieldset class="cbi-section">
		<legend><%:捕获设置%></legend>
		
		<div class="cbi-value">
			<label class="cbi-value-title"><%:网络接口%></label>
			<div class="cbi-value-field">
				<div class="interface-row">
					<select id="interface" class="cbi-input-select interface-select">
						<option value=""><%:正在加载接口...%></option>
					</select>
					<button id="btn-refresh" class="tcpdump-btn tcpdump-btn-reload" onclick="refreshInterfaces()">
						<%:刷新接口%>
					</button>
				</div>
			</div>
		</div>

		<div class="cbi-value">
			<label class="cbi-value-title"><%:网络数据过滤器%></label>
			<div class="cbi-value-field">
				<div class="filter-input-row">
					<input type="text" id="filter" class="cbi-input-text filter-input" 
						   placeholder="输入 BPF 过滤器，例如: port 80 or port 443" />
					<button type="button" class="tcpdump-btn tcpdump-btn-preset advanced-filter-btn" onclick="showAdvancedFilterDialog()">
						<%:高级过滤器%>
					</button>
				</div>
				
				<div class="port-preset-row">
					<span class="preset-label"><%:快速选择端口:%></span>
					<div class="port-preset-container">
						<!-- 端口按钮 (HTML 不变) -->
					</div>
				</div>
				
				<div class="cbi-value-description">
					<%:使用 BPF 语法，支持多个端口: port 80 or port 443。%><br>
					<%:留空捕获所有流量。%>
				</div>
			</div>
		</div>
		
		<div class="cbi-value">
			<label class="cbi-value-title"><%:文件大小限制 (MB)%></label>
			<div class="cbi-value-field">
				<div class="file-size-row">
					<div class="file-size-container">
						<input type="number" id="filesize" class="cbi-input-text file-size-input" placeholder="10" min="1" max="100" />
						<span>MB</span>
						<span id="file-size-display" class="file-size-display" style="display: none;">
							<span>当前文件大小: </span><span id="current-file-size">0 KB</span>
						</span>
					</div>
				</div>
				<div class="cbi-value-description">
					<%:最大文件大小 (1-100MB)，达到限制时自动停止抓包%>
				</div>
			</div>
		</div>

		<div class="cbi-value">
			<label class="cbi-value-title"><%:包数量限制%></label>
			<div class="cbi-value-field">
				<input type="number" id="count" class="cbi-input-text" placeholder="1000" min="1" max="100000" />
				<div class="cbi-value-description">
					<%:捕获指定数量的包后自动停止，留空表示无限制%>
				</div>
			</div>
		</div>
	</fieldset>

    <!-- 新增：高级功能区域 -->
    <fieldset class="cbi-section" id="advanced-settings" style="display: none;">
        <legend><%:高级功能%></legend>
        <div class="cbi-value">
            <label class="cbi-value-title" for="broute-toggle"><%:捕获二层桥接流量%></label>
            <div class="cbi-value-field">
                <label class="switch">
<%+footer%>
